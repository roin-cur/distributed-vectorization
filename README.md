# åˆ†å¸ƒå¼æ–‡æœ¬å‘é‡åŒ–æœåŠ¡ (Distributed Text Vectorization Service)

ä¸€ä¸ªå¯æ‰©å±•çš„åˆ†å¸ƒå¼æ–‡æœ¬å‘é‡åŒ–æœåŠ¡ï¼Œæ”¯æŒå¤§è§„æ¨¡æ–‡æœ¬æ•°æ®çš„å‘é‡åŒ–å¤„ç†å’Œå­˜å‚¨ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚    â”‚  Master Node    â”‚    â”‚  Worker Nodes   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  - REST API     â”‚â”€â”€â”€â–¶â”‚  - ä»»åŠ¡åˆ†å‘      â”‚â”€â”€â”€â–¶â”‚  - æ–‡æœ¬å‘é‡åŒ–    â”‚
â”‚  - ä»»åŠ¡æäº¤     â”‚    â”‚  - çŠ¶æ€ç›‘æ§      â”‚    â”‚  - æ‰¹é‡å¤„ç†      â”‚
â”‚  - çŠ¶æ€æŸ¥è¯¢     â”‚    â”‚  - è´Ÿè½½å‡è¡¡      â”‚    â”‚  - ç»“æœå†™å…¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Kafka       â”‚    â”‚   Weaviate      â”‚    â”‚  HuggingFace    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  - ä»»åŠ¡é˜Ÿåˆ—      â”‚    â”‚  - å‘é‡å­˜å‚¨      â”‚    â”‚  - é¢„è®­ç»ƒæ¨¡å‹    â”‚
â”‚  - æ¶ˆæ¯é‡è¯•      â”‚    â”‚  - è¯­ä¹‰æœç´¢      â”‚    â”‚  - æ–‡æœ¬ç¼–ç       â”‚
â”‚  - è´Ÿè½½å‡è¡¡      â”‚    â”‚  - æ•°æ®æŒä¹…åŒ–    â”‚    â”‚  - GPUåŠ é€Ÿ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **åˆ†å¸ƒå¼æ¶æ„**: ä¸»ä»èŠ‚ç‚¹åˆ†ç¦»ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- **é«˜å¯ç”¨æ€§**: åŸºäºKafkaçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ”¯æŒä»»åŠ¡é‡è¯•å’Œæ•…éšœæ¢å¤
- **æ‰¹é‡å¤„ç†**: å·¥ä½œèŠ‚ç‚¹æ‰¹é‡æ¶ˆè´¹ä»»åŠ¡ï¼Œæé«˜å¤„ç†æ•ˆç‡
- **å‘é‡å­˜å‚¨**: é›†æˆWeaviateå‘é‡æ•°æ®åº“ï¼Œæ”¯æŒé«˜æ•ˆçš„è¯­ä¹‰æœç´¢
- **æ¨¡å‹æ”¯æŒ**: æ”¯æŒHuggingFaceç”Ÿæ€çš„å„ç§é¢„è®­ç»ƒæ¨¡å‹
- **å®¹å™¨åŒ–éƒ¨ç½²**: å®Œæ•´çš„Dockeræ”¯æŒï¼Œä¾¿äºéƒ¨ç½²å’Œæ‰©å±•
- **ç›‘æ§å‘Šè­¦**: å†…ç½®å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç›‘æ§

## ğŸ“ é¡¹ç›®ç»“æ„

```
distributed-vectorization/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ common/                   # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ logging.py           # æ—¥å¿—é…ç½®
â”‚   â”‚   â”œâ”€â”€ kafka_client.py      # Kafkaå®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”œâ”€â”€ weaviate_client.py   # Weaviateå®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â””â”€â”€ models.py            # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ master/                   # ä¸»èŠ‚ç‚¹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api.py               # REST APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ task_manager.py      # ä»»åŠ¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ scheduler.py         # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚   â””â”€â”€ monitor.py           # ç›‘æ§æœåŠ¡
â”‚   â”œâ”€â”€ worker/                   # å·¥ä½œèŠ‚ç‚¹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ consumer.py          # Kafkaæ¶ˆè´¹è€…
â”‚   â”‚   â”œâ”€â”€ vectorizer.py        # æ–‡æœ¬å‘é‡åŒ–å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ batch_processor.py   # æ‰¹é‡å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ health_check.py      # å¥åº·æ£€æŸ¥
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ text_processor.py    # æ–‡æœ¬é¢„å¤„ç†
â”‚       â”œâ”€â”€ model_loader.py      # æ¨¡å‹åŠ è½½å™¨
â”‚       â””â”€â”€ metrics.py           # æ€§èƒ½æŒ‡æ ‡
â”œâ”€â”€ docker/                       # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile.master        # ä¸»èŠ‚ç‚¹é•œåƒ
â”‚   â”œâ”€â”€ Dockerfile.worker        # å·¥ä½œèŠ‚ç‚¹é•œåƒ
â”‚   â””â”€â”€ docker-compose.yml       # æœ¬åœ°å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ master.yaml              # ä¸»èŠ‚ç‚¹é…ç½®
â”‚   â”œâ”€â”€ worker.yaml              # å·¥ä½œèŠ‚ç‚¹é…ç½®
â”‚   â””â”€â”€ kafka.properties         # Kafkaé…ç½®
â”œâ”€â”€ scripts/                      # éƒ¨ç½²å’Œç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh                 # ç¯å¢ƒåˆå§‹åŒ–
â”‚   â”œâ”€â”€ start_master.py          # å¯åŠ¨ä¸»èŠ‚ç‚¹
â”‚   â”œâ”€â”€ start_worker.py          # å¯åŠ¨å·¥ä½œèŠ‚ç‚¹
â”‚   â””â”€â”€ health_check.py          # å¥åº·æ£€æŸ¥è„šæœ¬
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ performance/             # æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ architecture.md         # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ api.md                   # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ deployment.md            # éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ development.md           # å¼€å‘æŒ‡å—
â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â”œâ”€â”€ requirements-dev.txt          # å¼€å‘ä¾èµ–
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI (å¼‚æ­¥é«˜æ€§èƒ½)
- **æ¶ˆæ¯é˜Ÿåˆ—**: Apache Kafka (é«˜ååé‡æ¶ˆæ¯å¤„ç†)
- **å‘é‡æ•°æ®åº“**: Weaviate (è¯­ä¹‰æœç´¢å’Œå‘é‡å­˜å‚¨)
- **æœºå™¨å­¦ä¹ **: HuggingFace Transformers (é¢„è®­ç»ƒæ¨¡å‹)
- **å®¹å™¨åŒ–**: Docker & Docker Compose
- **ç›‘æ§**: Prometheus + Grafana (å¯é€‰)
- **æ—¥å¿—**: Structured Logging with JSON format

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.9+
- Docker & Docker Compose
- è‡³å°‘8GBå†…å­˜ (æ¨è16GB+)
- GPUæ”¯æŒ (å¯é€‰ï¼Œç”¨äºåŠ é€Ÿå‘é‡åŒ–)

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd distributed-vectorization
```

2. **ç¯å¢ƒé…ç½®**
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡é…ç½®
cp .env.example .env

# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt
```

3. **å¯åŠ¨åŸºç¡€æœåŠ¡**
```bash
# å¯åŠ¨Kafkaå’ŒWeaviate
docker-compose up -d kafka weaviate

# ç­‰å¾…æœåŠ¡å°±ç»ª
./scripts/health_check.py
```

4. **å¯åŠ¨æœåŠ¡**
```bash
# å¯åŠ¨ä¸»èŠ‚ç‚¹
python scripts/start_master.py

# å¯åŠ¨å·¥ä½œèŠ‚ç‚¹ (å¦ä¸€ä¸ªç»ˆç«¯)
python scripts/start_worker.py
```

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆ
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

## ğŸ“Š APIä½¿ç”¨ç¤ºä¾‹

### æäº¤å‘é‡åŒ–ä»»åŠ¡

```bash
curl -X POST "http://localhost:8000/api/v1/vectorize" \
  -H "Content-Type: application/json" \
  -d '{
    "texts": ["Hello world", "Machine learning is awesome"],
    "model_name": "sentence-transformers/all-MiniLM-L6-v2",
    "batch_size": 32
  }'
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl "http://localhost:8000/api/v1/tasks/{task_id}/status"
```

### è¯­ä¹‰æœç´¢

```bash
curl -X POST "http://localhost:8000/api/v1/search" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "artificial intelligence",
    "limit": 10,
    "threshold": 0.7
  }'
```

## ğŸ”§ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®æ–‡ä»¶ä½äº `config/` ç›®å½•ä¸‹ï¼š

- `master.yaml`: ä¸»èŠ‚ç‚¹é…ç½® (APIç«¯å£ã€Kafkaè¿æ¥ç­‰)
- `worker.yaml`: å·¥ä½œèŠ‚ç‚¹é…ç½® (æ‰¹å¤„ç†å¤§å°ã€æ¨¡å‹è®¾ç½®ç­‰)
- `kafka.properties`: Kafkaè¿æ¥å’Œä¸»é¢˜é…ç½®

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒ [é…ç½®æ–‡æ¡£](docs/deployment.md)ã€‚

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **æ‰¹é‡å¤„ç†**: å·¥ä½œèŠ‚ç‚¹æ”¯æŒæ‰¹é‡å¤„ç†æ–‡æœ¬ï¼Œæé«˜GPUåˆ©ç”¨ç‡
- **æ¨¡å‹ç¼“å­˜**: æ™ºèƒ½æ¨¡å‹åŠ è½½å’Œç¼“å­˜æœºåˆ¶
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**: å…¨å¼‚æ­¥æ¶æ„ï¼Œæé«˜å¹¶å‘æ€§èƒ½

## ğŸ” ç›‘æ§å’Œå‘Šè­¦

- å¥åº·æ£€æŸ¥ç«¯ç‚¹: `/health`
- æ€§èƒ½æŒ‡æ ‡ç«¯ç‚¹: `/metrics`
- ä»»åŠ¡ç»Ÿè®¡é¢æ¿: `/dashboard`

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ†˜ æ”¯æŒ

å¦‚æœä½ é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [æ–‡æ¡£](docs/)
2. æœç´¢ [Issues](../../issues)
3. åˆ›å»ºæ–°çš„ [Issue](../../issues/new)

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå¼€å‘ä¸­çš„é¡¹ç›®ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½è¿˜åœ¨å®Œå–„ä¸­ã€‚æ¬¢è¿è´¡çŒ®ä»£ç å’Œåé¦ˆï¼